---
title: "他のレコードと違う存在になりたいレコードへ"
emoji: "🤡"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["DB", "レコード", "識別子"]
published: false
---

# TL;DR

# はじめに

データベースにおいて、データを一意に識別する手段は、システムの信頼性と効率の土台を築きます。多くのアプリケーションフレームワークは、シンプルで実績のある「Auto Increment」方式をデフォルトの識別子として採用しています。これは、連続して増加する数値を使い、データベースの各レコードにユニークなIDを割り振る方法です。この方法の単純さは、特に単一データベースサーバーや小規模アプリケーションにおいて強みとなります。

しかし、現代のアプリケーションは、シンプルなブログやウェブショップを越え、分散システム、マイクロサービスアーキテクチャ、クラウドベースのスケーラビリティを求められることが増えています。このような複雑なシステムでは、Auto Increment方式のIDには限界が顕在化します。スケールアウトや複数の書き込みノードが存在する環境では、IDの衝突を避けるために追加の工夫が必要となり、管理が複雑になりがちです。さらに、IDが予測可能なシーケンスであることは、セキュリティー上のリスクをもたらす可能性があります。

これらの課題に対処するため、UUID、ULID、Snowflakeなどの新しい形式の識別子が登場しました。これらはユニークさ、スケーラビリティ、生成の予測不可能性など、特定の利点を提供し、厳しい要求を持つ現代のアプリケーションのニーズに応えることを目指しています。本記事では、これらの識別子の機能と、それぞれが最適な状況について掘り下げていきます。

# データ識別子

## Auto Increment

| id  | name  | email             |
| --- | ----- | ----------------- |
| 1   | Alice | alice@example.com |
| 2   | Bob   | bob@example.com   |
| 3   | Peter | peter@example.com |
| 4   | Tom   | tom@example.com   |

### 構造

<!-- textlint-disable -->

整数（Int）型

<!-- textlint-enable -->

### 特徴

- 整数型を使用し、通常は1から始まる連番です
- 新しいレコードがデータベースに挿入されるたびに、自動的に次の番号がIDに割り当てられます
- 多くのオブジェクトリレーショナルマッピング（ORM）フレームワークやウェブアプリケーションフレームワークがデフォルトで使用します

## UUID v4

| id                                   | name  | email             |
| ------------------------------------ | ----- | ----------------- |
| 550e8400-e29b-41d4-a716-446655440000 | Alice | alice@example.com |
| 123e4567-e89b-12d3-a456-426614174000 | Bob   | bob@example.com   |
| 0c74f13f-fa83-4c48-9b33-689fed9a34b7 | Peter | peter@example.com |
| 5f9c7df8-3d59-4846-99fe-c4518e82c86f | Tom   | tom@example.com   |

### 構造

<!-- textlint-disable -->

128bit長、16進数表記

<!-- textlint-enable -->

```
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                            rand_a                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            rand_a             |  ver  |       rand_b          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |var|                        rand_c                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                            rand_c                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

- ランダム値（122bit）
- バージョンとバリアント（6bit）

### 特徴

- 128bit長で、8-4-4-4-12の形式に分かれた16進表記を用いて表されます
- 全世界でユニークな値である可能性が非常に高いです

## ULID

| id                         | name  | email             |
| -------------------------- | ----- | ----------------- |
| 01ARZ3NDEKTSV4RRFFQ69G5FAV | Alice | alice@example.com |
| 01ARYZ6S41TSV4RRFFQ69G5FAV | Bob   | bob@example.com   |
| 01AS3YPYXJTSV4RRFFQ69G5FAV | Peter | peter@example.com |
| 01B2M2Y8JPTSV4RRFFQ69G5FAV | Tom   | tom@example.com   |

### 構造

タイムスタンプ（48bit）とランダム値（80bit）

### 特徴

- Base32エンコーディングを使用し、26文字のアルファベットと数字で構成されます
- 時系列情報を含み、生成された順にソートが可能です

## Snowflake

| id                  | name  | email             |
| ------------------- | ----- | ----------------- |
| 1382971839180339201 | Alice | alice@example.com |
| 1382971839180339202 | Bob   | bob@example.com   |
| 1382971839180339203 | Peter | peter@example.com |
| 1382971839180339204 | Tom   | tom@example.com   |

### 構造

<!-- textlint-disable -->

64bit整数

<!-- textlint-enable -->

```
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         timestamp(ms)                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     timestamp(ms)   |    worker id    |    sequence number    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

### 特徴

- Twitterによって開発された方式（[参考](https://github.com/twitter-archive/snowflake)）です
- タイムスタンプ、データセンターまたはワーカーノードのID、シーケンス番号の情報が含まれています
- 時系列情報が組み込まれているため、生成された順番に沿ってソート可能です

## UUID v7

| id                                   | name  | email             |
| ------------------------------------ | ----- | ----------------- |
| 01715b4c-b8e7-7d59-b6e7-6967c6c7c080 | Alice | alice@example.com |
| 01715b4c-b8e8-7dfa-a470-8969b8b8b890 | Bob   | bob@example.com   |
| 01715b4c-b8e9-7e1b-b6f8-9968d6d8d8a0 | Peter | peter@example.com |
| 01715b4c-b8ea-7e5c-b7e9-a678c7c8c8b0 | Tom   | tom@example.com   |

### 構造

<!-- textlint-disable -->

128bit長、16進数表記

<!-- textlint-enable -->

```
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           unix_ts_ms                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          unix_ts_ms           |  ver  |       rand_a          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |var|                        rand_b                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                            rand_b                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

- タイムスタンプ（48bit）
- バージョンとバリアント（6bit）
- ランダム値（74bit）

### 特徴

- UUIDの新しいバージョンで、時系列順序に基づいたID生成が可能です
- ソート可能な時系列情報を含んでおり、UUID v4よりも高度な時系列管理が可能です

# データ識別子の比較

# ユースケース

# おわりに

# 参考文献

https://speakerdeck.com/matteobertozzi/ulid-vs-uuid
https://www.slideshare.net/moaikids/20130901-snowflake
