---
title: "アーキテクチャとの付き合い方"
emoji: "⚙️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["architecture"]
published: false
---

# TL;DR

- アーキテクチャカンファレンス 2024 に参加
- アーキテクチャ設計は、リプレースや大規模な設計変更を進める際に避けられない課題
- トレードオフ分析では、評価軸の重み付けや市場の変化に応じた見直しが重要
- アーキテクチャはあくまでビジネス目標達成の手段であり、設計と目標の調和が求められる
- 進化的アーキテクチャは、シンプルさと柔軟性を重視し、偶有的複雑性を最小化する実践的なアプローチ

# はじめに

こんにちは、直近はシステムのリプレースに着手している内藤です。
リプレースや大規模な設計変更を進めている方にとって、アーキテクチャ設計の悩みは尽きないですよね。

先日参加した「アーキテクチャカンファレンス 2024」では、トレードオフ分析の重要性や進化的アーキテクチャによる柔軟なシステム設計など、現場に直結するテーマが数多く取り上げられていました。

この記事では、その中でも特に印象的だった「トレードオフ分析の重要性」、「組織とアーキテクチャの相互作用」、そして「進化的アーキテクチャの実践」に焦点を当て、私が得た知見を共有できればと思います👋

# トレードオフ分析の重要性

<!-- textlint-disable -->

トレードオフとは、複数の要件や目標が競合する中で、最適な選択を行うために他の選択肢を犠牲にする必要がある状況を指します。アーキテクチャ設計では、性能、コスト、スケーラビリティ、保守性など相反する要求をどうバランスさせるかが常に問われます。ここでは、トレードオフ分析で重要なポイントをいくつか紹介します!

<!-- textlint-enable -->

## 評価軸の重み付けが均一ではない

キーノートセッションでは、「**全ての評価軸が同等の重みを持つわけではない**」という洞察が共有されました。
https://speakerdeck.com/findyinc/modern-trade-off-analysis

たとえば、性能とスケーラビリティで優れる案と、コストや保守性など他の多くの軸で優れる案があった場合、性能が最優先されるプロジェクトでは前者が選ばれるべきです。

このように意思決定時には全ての項目を平等に扱うのではなく、**ビジネス目標やプロジェクト背景に応じて評価軸の重み付けを調整すること**が不可欠です。

## トレードオフ分析は進化する

トレードオフ分析は一度行って終わりではなく、市場環境やステークホルダーの要求、技術進化などによって条件が変化するため、継続的な見直しが必要です。
たとえば、短期的にはコスト削減が最優先される設計でも、事業が成長するにつれてスケーラビリティや保守性が重視されるケースは珍しくありません。このようにトレードオフ分析は「**プロジェクトの成長とともに進化するべきプロセス**」であることが強調されていました。

## 意思決定プロセスの透明性

トレードオフ分析を成功させるためには、意思決定プロセスを透明に保ち、関係者全員が評価基準や選択理由を理解できるようにすることが大切です。そのための有効な手法として **ADR（Architectural Decision Records）** があります。ADR は意思決定を体系的に記録し、その背景や理由を明確化するツールです。
たとえば ZOZO では ADR を活用し、過去の意思決定履歴を共有しています。これにより、新たな課題への迅速な対応や透明性向上につながっています。

https://docs.google.com/presentation/d/1ziV5yqWkqUZl6pCTmjGveB-QfgoSC_8BhYmpWy7mE6A/edit#slide=id.p1

## フィードバックループによる継続的改善

キーノートセッションでは、トレードオフ分析を支える仕組みとして**フィードバックループの構築も重要である**と述べられていました。設計上の選択肢が運用にどう影響したかを振り返り、継続的に評価することで意思決定精度が向上します。
たとえばエラーレートやレスポンスタイムなど運用データを定期的に分析し、設計変更が実際の運用結果にどのような影響を与えたか数値で可視化することが推奨されていました。

# 組織とアーキテクチャの相互作用

組織とアーキテクチャは密接に関連しています。アーキテクチャはあくまでビジネス目標を達成するための手段であり、その目標に適合した設計を追求する必要があります。

## 組織目標との調和

SanSan では、「適応度関数（Fitness Function）」を導入し、システム設計がビジネス目標と一致しているかを継続的に評価しています。たとえば、名刺管理システム「Bill One」の開発では、スループットやデータ整合性といったビジネス要件を適応度関数で定量的に評価し、それに基づいて設計改善を行っています。

また、オープンロジでは「目的達成型アプローチ」を採用し、システムがビジネスやユーザーの期待に応えるかどうかを常に検証しています。また、アクセスログを活用して未使用コードを特定・削除することでデッドコードを排除し、モジュール間の責務を明確化することで柔軟性を確保していました。

## コンウェイの法則とその適用

コンウェイの法則（「システム設計は組織構造を反映する」）は、多くの企業で実践的な指針として活用されています。Bitkey では、この法則を意識した設計プロセスが注目されています。同社ではイベントストーミングやモブプログラミングなどチーム全体が設計プロセスに参加する手法を採用し、組織構造と一致した効率的なアーキテクチャ設計を実現していました。

さらに、ナレッジワーク社では「コンパウンド戦略」を推進するためにリアーキテクチャを実施しました。複数プロダクト展開が可能なアーキテクチャへの移行では、チーム間連携や共通基盤整備に注力していました。

# 進化的アーキテクチャの実践

進化的アーキテクチャとは、システムが変化する要求や環境に柔軟に対応できるよう設計されるべきだという考え方です。このセクションでは、「シンプルさと柔軟性」「偶有的複雑性の最小化」に焦点を当てて解説します。

## シンプルさと柔軟性

進化的アーキテクチャでは、シンプルな設計を基盤とし、変更への対応力を高めることが重要です。オープンロジではアクセスログから未使用コードを特定・削除しデッドコード排除を実現し、モジュール間責務の明確化によってシステムの柔軟性を高めていました。

SanSan では、適応度関数を用いてビジネス要件を継続的に評価し、シンプルかつ拡張性のある設計を実践しています。たとえば、「Bill One」の開発ではビジネス要件（例：スループットやデータ整合性）が達成されているか継続的に評価し、それに基づいて設計改善が行われていました。

## 偶有的複雑性の最小化

偶有的複雑性とは、本質的課題に付随する不要な複雑さを指します。ログラスでは、この偶有的複雑性排除に注力し、本質的課題解決への集中環境を整備しています。同社は「Enabling & Platform」部門を設置し、横断的課題（例：技術負債や運用コスト）への対処体制を構築していました。

https://speakerdeck.com/knih/architectures-and-topologies

# おわりに

アーキテクチャカンファレンス 2024 では、現代のソフトウェア開発における重要なテーマが議論され、以下の知見が得られました。

1. トレードオフ分析の重要性
   設計プロセスで避けられないトレードオフは、意思決定の質向上に直結します。多目的最適化やパレート最適解を活用することで、より良い設計判断が可能になります。

2. 組織とアーキテクチャの連動性
   組織構造と設計思想の一致は、効率的な開発プロセスを支える基盤です。コンウェイの法則や適応度関数を通じて、組織の目標に合ったアーキテクチャ設計が可能になります。

3. 進化的アーキテクチャの実践
   シンプルさと柔軟性を基盤に、偶有的複雑性を排除することで、システムの持続可能性と適応力を高めることができます。

これらの知見が、読者の皆さんのアーキテクチャ設計やプロジェクトの推進の一助となれば幸いです！
